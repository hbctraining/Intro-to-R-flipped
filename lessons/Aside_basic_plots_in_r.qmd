---
title: "Plotting and data visualization in base R"
description: |
  In this lesson, participants explore how to create and customize visualizations using base R graphics. They learn to generate scatterplots, barplots, histograms and boxplots while adjusting key plotting arguments that control labels, colors, point shapes and legends. Through handsâ€‘on examples, participants practice adjusting plot aesthetics.
author:
  - Meeta Mistry
  - Mary Piper
  - Radhika Khetani
date: "2025-05-30"
categories: 
  - R Programming
  - Data visualization
keywords:
  - R
  - base R graphics
  - scatterplots
  - histograms
  - barplots
  - boxplots
license: "CC-BY-4.0"
editor_options: 
  markdown: 
    wrap: 72
---

Approximate time: 45 minutes

```{r}
#| label: load_data_libraries
#| echo: false
metadata <- read.csv(file="data/mouse_exp_design.csv")
rpkm_ordered  <- read.csv("data/ordered_counts_rpkm.csv",
                          header=T, row.names = 1)

library(purrr)  # Load the purrr
samplemeans <- map_dbl(rpkm_ordered, mean) 

age_in_days <- c(40, 32, 38, 35, 41, 32, 34, 26, 28, 28, 30, 32)    	
new_metadata <- data.frame(metadata, samplemeans, age_in_days) 
```

## Plots in base R

R has a number of built-in tools for basic graph types such as histograms, scatter plots, bar charts, boxplots and much [more](http://www.statmethods.net/graphs/). Rather than going through all of different types, we will focus on `plot()`, a generic function for plotting x-y data. 

To get a quick view of the different things you can do with `plot`, let's use the `example()` function:
```{r}	
#| label: plot_example
#| eval: FALSE
# Get an example of a plot
example("plot.default")
```

Here, you will find yourself having to press `<Return>` so you can scroll through the different types of graphs generated by `plot`. Take note of the different parameters used with each command and how that affects the aesthetics of the plot. 

```{r}
#| label: exit_example
#| eval: false
# Close the example
dev.off() 
```

### Scatterplot
For some hands-on practice we are going to use `plot` to draw a scatter plot and obtain a graphical view of the relationship between two sets of continuous numeric data. From our new_metadata file we will take the `samplemeans` column and plot it against `age_in_days`, to see how mean expression changes with age. 

Now our metadata has all the information to draw a scatterplot. The base R function to do this is `plot(y ~ x, data)`:
```{r}
#| label: scatterplot_example
# Create Scatterplot
plot(samplemeans ~ age_in_days, data=new_metadata)
```

Each point represents a sample. The values on the y-axis correspond to the average expression for each sample which is dependent on the x-axis variable `age_in_days`. This plot is in its simplest form, we can customize many features of the plot (fonts, colors, axes, titles) through [graphic options](http://www.statmethods.net/advgraphs/parameters.html).

For example, let's start by giving our **plot a title and renaming the axes**. We can do that by simply adding the options `xlab`, `ylab` and `main` as arguments to the `plot()` function:

```{r}
#| label: add_title_axes
# Add title and axes
plot(samplemeans ~ age_in_days,
     data=new_metadata, 
     main="Expression changes with age",
     xlab="Age (days)",
     ylab="Mean expression")
```	
	

We can also change the **shape of the data point using the `pch`** option and the **size of the data points using `cex`** (specifying the amount to magnify relative to the default).

```{r}
#| label: change_point_size_shape
# Change the point size and shape
plot(samplemeans ~ age_in_days,
     data=new_metadata,
     main="Expression changes with age",
     xlab="Age (days)",
     ylab="Mean expression",
     pch="*",
     cex=2.0)
```

We can also add some **color to the data points** on the plot by adding `col="blue"`. Alternatively, you can sub in any of the default colors or you can [experiment with other R packages](http://www.stat.ubc.ca/~jenny/STAT545A/block14_colors.html#basic-color-specification-and-the-default-palette) to fiddle with better palettes. 

We can also add color to **separate the data points by information** in our data frame. For example, suppose we wanted to the data points colored by celltype. We would need to specify a vector of colors and provide the factor by which we are separating samples. The first level in our factor vector (which by default is assigned alphabetically) would get assigned the first color that we list. So in this case, blue corresponds to celltype A samples and green corresponds to celltype B.

```{r}
#| label: add_color_by_celltype
# Factor celltype
new_metadata$celltype <- factor(new_metadata$celltype)

# Plot data with color
plot(samplemeans ~ age_in_days,
     data=new_metadata,
     main="Expression changes with age",
     xlab="Age (days)",
     ylab="Mean expression",
     pch="*",
     cex=2.0,
     col=c("blue", "green")[celltype])
```


The last thing this plot needs is a **figure legend describing the color scheme**. It would be great if it created one for you by default, but with R base functions unfortunately it is not that easy. To draw a legend on the current plot, you need to run a **new function called `legend()`** and specify the appropriate arguments. The code to do so is provided below. Don't worry if it seems confusing, we plan on showing you a much more intuitive way of plotting your data.

```{r}
#| label: add_legend
# Create plot
plot(samplemeans ~ age_in_days, data=new_metadata,
     main="Expression changes with age",
     xlab="Age (days)",
     ylab="Mean expression",
     pch="*",
     cex=2.0,
     col=c("blue", "green")[celltype])

# Add legend
legend("topleft",
       pch="*",
       col=c("blue", "green"),
       c("A", "B"),
       cex=0.8,
       title="Celltype")
```

::: callout-tip
# [Exercise 1](Aside_basic_plots_in_r-Answer_key.qmd#exercise-1)

1. Change the color scheme in the scatterplot, such that it reflects the `genotype` of samples rather than `celltype`.

2. Use R help to find out how to increase the size of the text on the axis labels.
:::

::: {.callout-note collapse=TRUE}
# Other Types of Plots in Base R

*NOTE: we will not run these in class, but the code is provided if you are interested in exploring more on your own.*

## Barplot 
Barplots are useful for comparing the distribution of a quantitative variable (numeric) between groups or categories. A **barplot**  would be much more useful to compare the samplemeans (numeric variable) for each sample. We can use `barplot` to draw a single bar representing each sample and the height indicates the average expression level. 

```{r}
#| label: barplot_help
# Open help page for barplot
# Note that there is no "data=" argument for barplot()
?barplot
```

Similar to the scatterplot, we can use additional arguments to specify the aesthetics that we want to change. For example, changing axis labeling and adding some color.

```{r}
#| label: barplot_example
# Create barplot
barplot(new_metadata$samplemeans,
        names.arg=c(1:12),
        horiz=TRUE,
        col=c("darkblue", "red")[new_metadata$genotype]) 
```	

## Histogram 
If we are interested in an overall distribution of numerical data, a **histogram** is what we'd want. To plot a histogram of the data use the `hist` command:

```{r}
#| label: histogram_example
# Create histogram
hist(new_metadata$samplemeans)
```

Again, there are many options that we can change by modifying the default parameters. Let's color in the bars, remove the borders and increase the number of breaks:

```{r}
#| label: histogram_modifcations
# Add modifications to histogram
hist(new_metadata$samplemeans,
     xlab="Mean expression level",
     main="",
     col="darkgrey",
     border=FALSE) 
```

## Boxplot

Using additional sample information from our metadata, we can use plots to compare values between different factor levels or categories. For example, we can compare the sample means across celltypes 'typeA' and 'typeB' using a **boxplot**.

```{r}
#| label: boxplot_example
# Boxplot
boxplot(samplemeans~celltype,
        data=new_metadata)
```
:::
